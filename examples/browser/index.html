<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>frameflow dev</title>
    <style>
        button {font-size: 1em}
    </style>
</head>

<body>
    <script>
        /**
         * Rename frameflow to fflow. Just like: ES6 import (optional)
         * import fflow from 'frameflow'
         */
        window.onload = () => window.fflow = frameflow
    </script>

    <p>Here are some examples, each starts with ðŸ‘‰.</p>
    <p>Please open console to see more information.</p>

    <h2>ðŸ‘‰Fetch and get metadata</h2>
    <button id="metadata">Metadata</button>
    <script>
        document.getElementById('metadata').onclick = async () => {
            const src = await fflow.source("./assets/flame.avi")
            console.log('Metadata:', src.metadata)
        }
    </script>


    <h2>ðŸ‘‰Trancode</h2>
    <video id="transcode-video" controls src="./assets/flame.avi"></video><br />
    <button id="transcode">Transcode</button>
    <span id="transcode-progress"></span>
    <script>
        document.getElementById('transcode').onclick = async () => {
            const onProgress = pg => document.getElementById('transcode-progress').textContent = `${(pg*100).toFixed(2)}%`
            const src = await fflow.source('./assets/flame.avi')
            const blob = await src.exportTo(Blob, {format: 'mp4', progress: onProgress}) 
            document.getElementById('transcode-video').src = URL.createObjectURL(blob)
        }
    </script>


    <h2>ðŸ‘‰Filter: trim</h2>
    <video id="trim-video" controls></video><br />
    <button id="trim">Trim</button>
    <span id="trim-progress"></span>
    <script>
        document.getElementById('trim').onclick = async () => {
            const onProgress = pg => document.getElementById('trim-progress').textContent = `${(pg*100).toFixed(2)}%`
            const src = await fflow.source('./assets/flame.avi')
            const trimSrc = src.trim({start: 1, duration: 1})
            const blob = await trimSrc.exportTo(Blob, {format: 'mp4', progress: onProgress}) 
            document.getElementById('trim-video').src = URL.createObjectURL(blob)
        }
    </script>


    <h2>ðŸ‘‰Hybrid: trim + transcode + mux</h2>
    <video id="hybrid-video" controls></video><br />
    <button id="mux">Mux</button>
    <span id="mux-progress"></span>
    <script>
        document.getElementById('trim').onclick = async () => {
            const onProgress = pg => document.getElementById('trim-progress').textContent = `${(pg*100).toFixed(2)}%`
            const src = await fflow.source('./assets/flame.avi')
            const trimSrc = src.trim({start: 1, duration: 1})
            const blob = await trimSrc.exportTo(Blob, {format: 'mp4', progress: onProgress}) 
            document.getElementById('trim-video').src = URL.createObjectURL(blob)
        }
    </script>

    <h2>ðŸ‘‰Upload video (testing...) </h2>
    <video id="trim-video" controls></video><br />
    <input id="uploader" type="file" />
    <button id="test-transcode">Transcode</button>
    <span id="test-progress"></span>
    <script>
        let video = null
        const fileDom = document.getElementById('uploader')
        fileDom.onchange = (e) => video = e.target.files[0]
        
        document.getElementById('test-transcode').onclick = async () => {
            const onProgress = pg => document.getElementById('test-progress').textContent = `${(pg*100).toFixed(2)}%`
            const src = await fflow.source(video)
            console.log('Metadata:', src.metadata)
            const blob = await src.filter('audio').tracks()[0].exportTo(Blob, {format: 'avi', progress: onProgress}) 
            
            const link = document.createElement('a')
            link.href = URL.createObjectURL(blob)
            link.download = 'output_video'
            link.innerHTML = "Click to download";
            document.body.appendChild(link)
        }
    </script>
</body>

</html>